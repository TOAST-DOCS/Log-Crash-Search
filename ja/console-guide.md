## Analytics > Log & Crash Search > コンソール使用ガイド

> [告知]
> arm64eアーキテクチャを使用する新規端末(iPhone XS、XR、XS Max、iPad Pros 3rd)で発生したクラッシュログは、発生件数の集計のみ可能で、クラッシュ内容の分析はまだサポートされていません。
> 近日中に新規端末向けの分析機能を提供したいと思います。

Log & Crash Searchは、次のような順序で使用できます。

- サービス有効化
プロジェクトを作成し、プロジェクトを選択した後、 Log & Crash Searchを有効化します。
- ログ転送
Log & Crash Search SDKを通して、ログの転送を開始します。
- ログ確認 
ログを転送した後は、**ログ検索**または**アプリクラッシュ検索**画面でチャートや検索など、多様な方式でログを確認できます。

## プロジェクト選択

コンソールに接続し、左側メニューを利用して組織(Organization)とプロジェクト(Project)を選択します。組織やプロジェクトがない場合は、作成する必要があります。
- 左側メニューから**ORGANIZATION > PROJECT**をクリックします。

組織とプロジェクトの作成方法は[TOASTコンソール使用ガイド](https://docs.toast.com/ko/TOAST/ko/console-guide/)を参照してください。

## サービス有効化

プロジェクト(Project)を選択した状態で、画面上部にある**サービス選択**ボタンをクリックして、**Analytics**の下**Log & Crash Search**をクリックします。サービスが有効になると、サービス名の横に選択(v)表示が現れます。

> [参考]  
> サービスを有効にした後は、約5分後から転送できます。

Log & Crash Searchが有効になると、左側メニューに**Analytics > Log & Crash Search**メニューが現れ、Appkeyが作成されます。

## Appkey確認

ログを転送するには、Appkeyを確認する必要があります。

1. 左側のメニューから、**Analytics > Log & Crash Search > ログ検索**をクリックします。
2. コンソール画面上部の**URL & Appkey**ボタンをクリックすると、Log & Crash Search用Appkeyを確認できます。

## ログ転送

ログを転送するには、Log & Crash Search SDKが必要です。
SDKは[TOAST Downloads](https://docs.toast.com/ko/Download/)ページの**Analytics > Log & Crash Search**でダウンロードできます。

> [参考]  
> ログの量が少ない場合は、約5分後にログ転送の結果が反映されます。

## ログ検索

転送したログをLog Search機能を利用して検索してみましょう。

1. コンソール画面の左側にあるメニューから**Analytics > Log & Crash Search > ログ検索**をクリックします。
2. **ログ検索**タブには、基本的に24時間のログ量のグラフと詳細内容が表示されます。

![lcs_01_201812](https://static.toastoven.net/prod_logncrash/lcs_01_201812.png)

**ログ検索**画面は、次のように構成されています。

![lcs_02_201812](https://static.toastoven.net/prod_logncrash/lcs_02_201812.png)

| 項目 | 説明 |
|---|---|
| 検索クエリー入力 | クエリーフィールド検索はLucene文法を使用できます。 <br/> (参照：http://lucene.apache.org/core/2_9_4/queryparsersyntax.html)|
| 検索対象期間 | 検索クエリーの期間条件を設定できます。 |
| ログ検索結果 > チャート | ログ検索結果を棒グラフで表示し、クリックすると右側の単位(ex：1Bar=1hour)に合った期間を基準に表示します。 |
| フィールド検索条件 | - Platform：ユーザーデバイスのOSおよびバージョンで区分<br/>- host：ホスト名やIPアドレスで区分<br/> - logLevel：ログレベルで区分(FATAL / ERROR / WARN / INFO / DEBUG)<br/> - logSource：ユーザーが設定したログソースで区分<br/> - logType：ユーザーが設定したプロジェクト名で区分<br/> - projectVersion：ユーザーが設定したプロジェクトバージョンで区分<br/><br/> - **Show all fields**をクリックして、別のフィールドを検索条件に追加できます。 |
| ログ検索結果 > ログレコード | 検索したログの詳細内容が表示される部分です。表示されたログの各項目は、クリックして検索クエリーを変更できます。 |

ユーザーが設定した検索条件は、検索クエリー入力ウィンドウに反映されますが、このクエリーを保存することもでき([クエリー保存])、保存されているクエリーを利用して検索することも([保存クエリー選択])できます。

## アプリクラッシュ照会

Android、iOS端末のクラッシュ情報は、**Analytics > Log & Crash Search > アプリクラッシュ検索**で確認できます。


### イシュー照会
**イシュー照会**タブの**エラータイプ**で**Crashes**を選択すると、イシューを確認できます。

![lcs_03_201812](https://static.toastoven.net/prod_logncrash/lcs_03_201812.png)

**イシュー照会**タブの**エラータイプ**で**Handled**を選択すると、handledイシューを確認できます。

![lcs_04_201812](https://static.toastoven.net/prod_logncrash/lcs_04_201812.png)

|項目|	説明|
|---|---|
|チャート| イシュー要約とクラッシュ発生件数をタイムラインチャートに表示します。|
|エラータイプ| システムで発生するCrashと、Exceptionブロックでユーザーが発生させるHandledに分類されます。|
|検索条件|	状態–クラッシュイシュー処理状態 <br/> 最近–直近のN日間に収集されたクラッシュログ照会フィルタ <br/>アプリバージョン - アプリのバージョン<br/> OSバージョン–OSのバージョン <br/> ログレベル：FATAL / ERROR / WARN / INFO / DEBUGタイプ照会フィルタ<br/> タグ–タグ <br/> 最小発生数–クラッシュ発生最小N件以上のクラッシュ照会フィルタ <br/> 例外の種類–例外の種類別最近フィルタ <br/> 位置–クラッシュ発生地点別照会フィルタ |
|イシューリスト|イシューリストを表示します。右上のリストボックスを利用してソート順序を変更でき、リスト左側の選択ボックスからイシュー状態を変更できます。|

リストでイシューをクリックすると、該当イシューの詳細情報を確認できます。

![lcs_05_201812](https://static.toastoven.net/prod_logncrash/lcs_05_201812.png)

|項目|	説明|
|---|---|
|状態|	イシュー状態を未解決、解決、再登録、完了などの状態に設定できます|
|課題トラッカー設定|	GitHub、GitLabなど、外部の課題トラッカーを設定して、該当イシューを外部課題トラッカーに登録できます。|
|タグ|	タグを追加したり、追加されたタグを変更、削除できます。|
|ETC - 検索ページで参照|	クリックするとログ検索ページに移動します。|
|スタック追跡|	クラッシュが発生した例外の種類、例外の原因およびスタックトレース情報を表示します。|
|エラーインスタンス|	エラーインスタンスリストを表示します。|
|ユーザー| イシューを発生させたユーザーリストを表示します。|
|意見| 該当イシューに対してコメントを作成でき、プロジェクト構成メンバーが作成したコメントリストを表示します。|
|ヒストリー|	該当イシューに対する管理履歴(状態変更、タグ追加、コメント作成など)をタイムラインで表示します。|
|ヒストリーグラフ| イシュー発生件数をタイムラインチャートとワールドマップで表示します。|
|マトリックス情報| ネットワーク、OSバージョン、デバイス、サービスプロバイダー、国情報を表示します。|

### リアルタイムモニタリング

![lcs_06_201812](https://static.toastoven.net/prod_logncrash/lcs_06_201812.png)

約5分間のリアルタイムアプリクラッシュ発生をモニタリングします。

### トレンド

![lcs_07_201812](https://static.toastoven.net/prod_logncrash/lcs_07_201812.png)

|項目|	説明|
|---|---|
|時間条件| 統計時間条件を設定できます。 <br/> (7日、 2週、 30日)|
|トレンドグラフ| 多様なトレンドグラフを確認できます。<br/> - クラッシュ数<br/> - クラッシュが発生した端末<br/> - すべてのエラー統計 <br/> - 未解決エラー統計 <br/> - アプリバージョン別イシュー統計 <br/> - OSバージョン別イシュー統計 <br/> - 端末別イシュー統計 <br/> - 国別イシュー統計|

### アプリクラッシュ指標

![lcs_08_201812](https://static.toastoven.net/prod_logncrash/lcs_08_201812.png)

アプリクラッシュ指標は、セッション/クラッシュファイル/発生率(%)/以前の期間のクラッシュ/増加率(%)情報を提供します。

1. アプリクラッシュ指標リンクをクリックして、別の指標画面に切り替えられます。
2. プラットフォーム(iOS、Android、 Windows)を選択して検索できます。
3. 検索期間と検索件数を調整できます。
4. バージョン別の結果を表で確認できます。

![lcs_09_201812](https://static.toastoven.net/prod_logncrash/lcs_09_201812.png)

アプリクラッシュ推移は、ユーザーが指定した期間内の発生数情報を提供します。

![lcs_10_201812](https://static.toastoven.net/prod_logncrash/lcs_10_201812.png)

クラッシュマップは、ユーザーが指定した期間内の発生クラッシュ数をマップ上に表示します。


### クラッシュユーザー

ユーザー別クラッシュ発生情報を提供します。

1. SDKでuser_idを設定する場合に使用可能で、保存しない場合、すべてのユーザーは'-'と表示されます。
2. ユーザーは、ユーザーIDとデバイス名を組み合わせて区別します。すなわち、ユーザーIDが同じでもデバイスが異なれば、違うユーザーとして集計されます。

![lcs_11_201812](https://static.toastoven.net/prod_logncrash/lcs_11_201812.png)


|項目|	説明|
|---|---|
|エラータイプ|	システムで発生させるCrash統計とExceptionブロックでユーザーが発生させるHandledに分類されます。
|ユーザー|	SDKにおいて、user_idで指定したユーザーIDを検索条件に設定できます。|
|端末| デバイス名を検索条件に設定できます。|
|時間条件| ユーザー別クラッシュ照会時間条件を設定できます。|
|アプリバージョン| アプリバージョン別に検索します。|

### イシュー統計

![lcs_12_201812](https://static.toastoven.net/prod_logncrash/lcs_12_201812.png)

|項目|説明|
|---|---|
|エラータイプ|	システムで発生したCrash統計と、Exceptionブロックでユーザーが発生させるHandled統計に分類されます。
|時間条件|	統計時間条件を設定できます。|
|アプリバージョン|	アプリバージョン別に検索します。|
|国| 発生したイシューを国別に検索します。|
|OSバージョン| クラッシュが発生した端末のOS別に検索します。|
|クラッシュ別発生頻度円グラフ|	クラッシュ別の発生頻度を表示します。|
|クラッシュ別発生頻度順位テーブル|	クラッシュ別の発生頻度順位を表示します。|

## アラーム

ログおよびクラッシュに対するアラーム設定およびアラーム送信履歴を確認できます。
**Analytics > Log & Crash Search > アラーム**をクリックします。

### ログアラーム設定

![lcs_13_201812](https://static.toastoven.net/prod_logncrash/lcs_13_201812.png)

ログアラームに対するすべての機能を実行できるページです。

- アラームは発生数に応じたアラームと、ログの増減率に応じたアラームに区分されます。
- アラームを受信したいログタイプ(Luceneクエリー)を登録し、該当ログが発生したら条件に応じてアラームを送信します。
- [発生数]、[増減率]の2つのタイプのアラームがあります。
- **アラーム追加**ボタンを押すと、アラームを登録できます。

#### 発生数アラーム

![lcs_14_201812](https://static.toastoven.net/prod_logncrash/lcs_14_201812.png)

- 発生数アラーム設定方法は次のとおりです。
    - アラームタイトル：アラーム設定リストに表示される名前を入力します。
    - アラームクエリー：アラームを受信したいログタイプをLuceneクエリーで入力します。
    - 説明：アラームの説明を入力します。
    - アラームタイプ：発生数アラームタイプに設定します。
    - アラームルール：**しきい値**に適用される不等号を選択します。
    - しきい値： '検索条件'に該当するログが'アラームルール'の不等号に応じて'しきい値'の数発生すると、アラームを送信します。
    - 発生周期：分単位で入力し、入力した時間値内にログが'しきい値'の数発生するとアラームを送信します。
    - スヌーズ：分単位で入力し、最小1分～最大1,440分(24時間)の間の値を設定します。(0は消える)
    - 受信者：アラームを受信する受信者を入力します。受信者ごとにメールとSMSを選択できます。
    - SMSアラーム文言：アラーム送信時にSMSで送信する文言を入力します。
    - コールバックURL：アラーム送信時に呼び出されるURLを入力します。 http(s)://とメール、Doorayフックをサポートします。

#### 増減率アラーム

![lcs_15_201812](https://static.toastoven.net/prod_logncrash/lcs_15_201812.png)

希望するログタイプ(Luceneクエリー)の発生増減率に応じて、アラームを送信します。

- 増減率アラーム設定方法は次のとおりです。
    - アラームタイトル：アラーム設定リストに表示される名前を入力します。
    - アラームクエリー：アラームを受信したいログタイプをLuceneクエリーで入力します。
    - 説明：アラームの説明を入力します。
    - アラームタイプ：増減率アラームタイプに設定します。
    - しきい値：'検索条件'に該当するログの増減率です。正の値のログが、以前の間隔に比べて増加した比率、0は以前の間隔とログ量が同じ。負の値は、以前の間隔に比べてログ量が減少した比率です。
    - 比較時間：時間単位で入力し、入力した時間間隔とそれ以前の間隔の間のログ量を'しきい値'に合わせて比較します。 '比較時間'の間に発生したログの増減率が'しきい値'を満たすと、アラームを送信します。
    - スヌーズ：分単位で入力し、最小1分～最大1,440分(24時間)の間の値を設定します。(0は消える)
    - 受信者：アラームを受信する受信者を入力します。受信者ごとにメールとSMSを選択できます。
    - SMSアラーム文言：アラーム送信時にSMSで送信する文言を入力します。
    - コールバックURL：アラーム送信時に呼び出されるURLを入力します。 http(s)://とメール、Doorayフックをサポートします。
### ログアラーム履歴

![lcs_16_201812](https://static.toastoven.net/prod_logncrash/lcs_16_201812.png)

- 設定したアラームリストが表示されます。
- リストをクリックすると、該当アラーム発生内容を確認できます。

### クラッシュアラーム設定

![lcs_17_201812](https://static.toastoven.net/prod_logncrash/lcs_17_201812.png)

クラッシュログに対するアラームを別途設定する機能です。プラットフォーム(iOS、Android、Windows、WebGL)別にそれぞれ1つずつ登録できます。

アラーム設定方法は次のとおりです。

- プラットフォーム：アラーム発生対象プラットフォームをiOS、Android、Windows、WebGLのうち1つを指定します。
- 新規クラッシュアラーム設定：アラーム発生をOn/Off処理できます。
- しきい値ベースのクラッシュアラーム設定：設定しきい値を超えると、アラームが作動するように設定します。探知周期は10分です。
    - アラームタイプ：クラッシュ発生数とクラッシュ発生率タイプがあります。
    - しきい値：クラッシュ発生数タイプはログ発生数(回数)を、クラッシュ発生率はログ発生確率(パーセント)を設定します。
- SMS通知文言使用：有効にすると、障害内容の代わりにSMSアラーム文言に入力した内容がSMSで送信されます。
- アラーム受信者：プロジェクトメンバーリストから、アラームを受信するユーザーのメール、 SMSを選択します。

### クラッシュアラーム履歴

![lcs_18_201812](https://static.toastoven.net/prod_logncrash/lcs_18_201812.png)

クラッシュログアラームが発生した履歴を照会します。

- プラットフォーム別に照会できます。
- 時間条件を設定して照会期間を調整できます。
- アラーム時間、プラットフォーム、クラッシュタイプ、しきい値、イベント数、配信方法および送信状態を提供します。

### ユーザーべースのアラーム設定

![lcs_19_201812](https://static.toastoven.net/prod_logncrash/lcs_19_201812.png)

クラッシュが発生したユーザー比率がしきい値(%)以上の場合、指定されたユーザーの携帯電話またはメールにアラームを送信する機能を提供します。

アラーム設定方法は次のとおりです。

- プラットフォーム：アラーム発生対象プラットフォームをiOS、Android、Windows、WebGLの中から1つを指定します。
- ユーザー基盤アラーム設定：アラーム発生をON/OFF処理できます。
- しきい値：クラッシュしたユーザー比率がしきい値(%)以上の場合、指定されたユーザーの端末またはメールにアラームを送信します。
- SMSアラーム文言：有効にすると、障害内容の代わりにSMSアラーム文言に入力された内容がSMSで送信されます。
- アラーム受信者：プロジェクトメンバーリストから、アラームを受信するユーザーのメール、SMSを選択します。

### ユーザー基盤アラーム履歴

![lcs_20_201812](https://static.toastoven.net/prod_logncrash/lcs_20_201812.png)

ユーザー基盤アラームが発生した履歴を照会します。

- プラットフォーム別に照会できます。
- 時間条件を設定して、照会期間を調節できます。
- アラーム時間、プラットフォーム、しきい値、クラッシュ発生ユーザー比率、配信方法および転送状態を提供します。

## 設定

検索フィールド管理、課題トラッカー設定、シンボルファイル管理などのサービスに必要な設定を管理します。

**Analytics > Log & Crash Search > 設定**をクリックします。


### 検索フィールド

ログ検索時に使用される検索フィールドを照会する機能です。システムフィールドである基本フィールドリストの他に、ユーザー転送フィールドであるユーザー指定フィールド(カスタムフィールド)を確認できます。

![lcs_21_201812](https://static.toastoven.net/prod_logncrash/lcs_21_201812.png)

1. ログ転送時、フィールド名がtxtで始まる場合、分析するかどうかがtrueに設定され、それ以外のフィールドは分析するかどうかがfalseに設定されます。分析するかどうかがfalseの場合、ログ検索の検索フィールドに登録して使用できます。
2. ログファイルやバイナリファイルを転送して、**ログ検索**画面で**ダウンロード > 参照**リンクを利用したい場合、 UserBinaryDataまたはUserTxtDataという名前のフィールドにbase64エンコードされた値を入れて転送してください。

### イシュートラッキング

課題トラッカーを設定すると、**アプリクラッシュ検索 > イシュー照会**タブでイシューリストをクリックした時に表示されるError Detailページで、該当エラーを課題トラッカーに登録して管理できます。

![lcs_22_201812](https://static.toastoven.net/prod_logncrash/lcs_22_201812.png)

- プラットフォーム： iOS、Android、Unityのうち1つのプラットフォームを選択します。課題トラッカーはプラットフォーム別にそれぞれ設定可能です。
- 課題トラッカー： GitHub、GitLabのうち1つを選択します。
- GitHubプロジェクトURL：課題トラッカーをGitHubに選択する場合、https://github.com/{user}/{project}形式のURLを入力します。
- Access token：課題トラッカーをGitHubに選択する場合、GitHubで作成したAccess tokenを入力します。(参照： https://help.github.com/articles/creating-an-access-token-for-command-line-use)
- GitLabプロジェクトURL：課題トラッカーをGitLabに選択する場合、http://{baseUrl}/{namespace}/{project}形式のURLを入力します。
- Private token：課題トラッカーをGitLabに選択する場合、GitLabサイトのMy profile - Accountで作成したtoken値を入力します。
- Issue Title Format：イシュータイトルにバージョンおよび位置情報を含めるかどうかを選択します。
- テスト：設定が正常かどうかを確認します。

### シンボルファイル

Symbolication fileが登録されていると、クラッシュログを確認できます。このメニューではSymbolication fileをアップロード、ダウンロードして削除できます。

![lcs_23_201812](https://static.toastoven.net/prod_logncrash/lcs_23_201812.png)

**[ファイル選択]**をクリックして、シンボルファイルをアップロードします。

- iOS： iOSシンボリケーションファイルをアップロードする時は、ZIP形式でBundleName.app.dSYMファイルを圧縮してください。
- Android： Androidシンボリケーションをアップロードする時は、mapping.txtファイルをアップロードする必要があります。
- Android-NDK： Android NDKファイルをアップロードする時は、ZIP形式でlib.soファイルを圧縮してください。
- Windows： Windowsシンボリケーションファイルをアップロードする時は、ZIP形式でBundleName.symファイルを圧縮してください。
- シンボルファイルの最大サイズは200MBです。
- Android NDKシンボリケーションファイルが許可する最大ファイルサイズを超える場合、原本‘lib.so’バイナリファイルのテキスト形式シンボルを含んでいる1つの‘lib.so.sym’を含むZIPファイル形式でアップロードできます。
- Android Unityの場合、シンボルファイルの登録が必要ありません。ただし、ProGuard適用時にmapping.txt.のアップロードが必要です。

### ログ保管期間

ログ保管期間を設定します。

![lcs_24_201812](https://static.toastoven.net/prod_logncrash/lcs_24_201812.png)

- ログ保管期間は1ヶ月、2ヶ月、3ヶ月、6ヶ月、1年の中から選択でき、ひと月に1回のみ変更できます。
- ログ保管期間ではないデータは、翌日に削除されます。

### ログ転送設定

サービスごとに、ログを転送するかを設定します。

![lcs_25_201812](https://static.toastoven.net/prod_logncrash/lcs_25_201812.png)

- 一般ログ、クラッシュログ、 Network Insightsログ、それぞれに対して転送するかを設定できます。
- TOASK SDKに対して転送するかどうかを設定できます。
    - 重複ログ、ログレベル、ログタイプでフィルタリングできます。
- 設定を保存した後、アプリを再起動すると適用されます。

## ネットワークインサイト

Log & Crash Search SDKから転送した遅延時間とエラー率をタイムラインチャートとURLリスト、マップに表示します。

**Analytics > Log & Crash Search > ネットワークインサイト**をクリックします。

- SDKでは、クライアントからURL設定画面で設定したURLまで、リクエストの遅延時間(Latency)と状態値(Status)をLog & Crash Searchに転送します。
- モニタリング、指標画面で現在のプラットフォームとフィルタを設定し、遅延時間とエラー率を確認できます。

### モニタリング

- 遅延時間とエラー率を、タイムラインチャートとURLリストに表示します。

![lcs_26_201812](https://static.toastoven.net/prod_logncrash/lcs_26_201812.png)

|項目| 説明|
|---|---|
|フィルタ条件 | - 最近：直近15分、 60分、24時間、48時間の時間別照会フィルタ、ユーザー指定は開始/終了日時を選択して照会(最大48時間) <br/> - アプリバージョン：アプリバージョン別照会フィルタ <br/> - OSバージョン：OSバージョン別照会フィルタ <br/> - 端末：デバイス名入力<br/> - サービスプロバイダー：サービスプロバイダーの名前を入力<br/> - 国：国別照会フィルタ <br/> - URL： URL別照会フィルタ|
|チャート| 遅延時間とエラー率がタイムラインチャートに表示されます。<br/>**現在のプラットフォーム**ドロップダウンメニューでiOS、Android、WindowsおよびWebGL別に設定できます。 |
|URL| URL設定で追加したURLごとに、遅延時間とエラー率を表示します。|

### マップ

- 遅延時間とエラー率をマップ上に表示します。

![lcs_27_201812](https://static.toastoven.net/prod_logncrash/lcs_27_201812.png)

|項目| 説明|
|---|---|
|マップタイプ| マップタイプ：遅延時間およびエラー率タイプを選択できます。<br/>|
|フィルタ条件 | - 最近：直近15分、 60分、24時間、48時間の時間別照会フィルタ、ユーザー指定は開始/終了日時を選択して照会(最大48時間) <br/> - アプリバージョン：アプリバージョン別照会フィルタ <br/> - OSバージョン：OSバージョン別照会フィルタ <br/> - 端末：デバイス名を入力<br/> - サービスプロバイダー：サービスプロバイダーの名前を入力<br/> - 国：国別照会フィルタ <br/> - URL： URL別照会フィルタ|
|マップ| 遅延時間とエラー率をマップ上に表示します。 <br/>**現在のプラットフォーム**ドロップダウンメニューでiOS、Android、WindowsおよびWebGL別に設定できます。|

### URL設定

- 遅延時間とエラー率を測定するWebサイトのURLを設定できます。

![lcs_28_201812](https://static.toastoven.net/prod_logncrash/lcs_28_201812.png)

|項目|説明|
|---|---|
|最後の変更日| URLを最後に追加または削除した日付です。|
|URL表| 遅延時間とエラー率を測定するWebサイトURLリストを表示します。<br/>右上の入力欄にURLを入力して追加できます。 <br/>削除する時は、リストをチェックして、**[選択項目削除]**をクリックすると選択項目を削除できます。 |
